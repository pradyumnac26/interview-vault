{"version":3,"sources":["../src/module.ts"],"sourcesContent":["import type { Without } from '@clerk/types';\nimport type { PluginOptions } from '@clerk/vue';\nimport {\n  addComponent,\n  addImports,\n  addImportsDir,\n  addPlugin,\n  addServerHandler,\n  addTypeTemplate,\n  createResolver,\n  defineNuxtModule,\n  updateRuntimeConfig,\n} from '@nuxt/kit';\n\nexport type ModuleOptions = Without<\n  PluginOptions,\n  'routerPush' | 'routerReplace' | 'publishableKey' | 'initialState'\n> & {\n  publishableKey?: string;\n  /**\n   * Skip the automatic server middleware registration. When enabled, you'll need to\n   * register the middleware manually in your application.\n   *\n   * @default false\n   *\n   * @example\n   *\n   * ```ts\n   * // server/middleware/clerk.ts\n   * import { clerkMiddleware } from '@clerk/nuxt/server'\n   *\n   * export default clerkMiddleware((event) => {\n   *   console.log('auth', event.context.auth())\n   * })\n   * ```\n   */\n  skipServerMiddleware?: boolean;\n};\n\nexport default defineNuxtModule<ModuleOptions>({\n  meta: {\n    name: PACKAGE_NAME,\n    version: PACKAGE_VERSION,\n    configKey: 'clerk',\n    compatibility: {\n      nuxt: '>=3.0.0',\n    },\n  },\n  setup(options, nuxt) {\n    // These values must be set (even as undefined) to allow runtime config to work properly.\n    // In Nuxt, having these keys defined (even as undefined) allows them to be overridden\n    // by environment variables following the pattern NUXT_PUBLIC_CLERK_* (e.g. NUXT_PUBLIC_CLERK_PUBLISHABLE_KEY).\n    // More info https://nuxt.com/docs/guide/going-further/runtime-config\n    void updateRuntimeConfig({\n      // Public keys exposed to client and shared with the server\n      public: {\n        clerk: {\n          ...options,\n          publishableKey: options.publishableKey,\n          signInUrl: options.signInUrl,\n          signInFallbackRedirectUrl: options.signInFallbackRedirectUrl,\n          signUpFallbackRedirectUrl: options.signUpFallbackRedirectUrl,\n          signInForceRedirectUrl: options.signInForceRedirectUrl,\n          signUpForceRedirectUrl: options.signUpForceRedirectUrl,\n          signUpUrl: options.signUpUrl,\n          domain: options.domain,\n          clerkJSUrl: options.clerkJSUrl,\n          clerkJSVariant: options.clerkJSVariant,\n          clerkJSVersion: options.clerkJSVersion,\n          isSatellite: options.isSatellite,\n          // Backend specific variables that are safe to share.\n          // We want them to be overridable like the other public keys (e.g NUXT_PUBLIC_CLERK_PROXY_URL)\n          proxyUrl: options.proxyUrl,\n          apiUrl: 'https://api.clerk.com',\n          apiVersion: 'v1',\n        },\n      },\n      // Private keys available only on within server-side\n      clerk: {\n        secretKey: undefined,\n        machineSecretKey: undefined,\n        jwtKey: undefined,\n        webhookSigningSecret: undefined,\n      },\n    });\n\n    const resolver = createResolver(import.meta.url);\n\n    // Handle Nuxt-specific imports (e.g #imports)\n    nuxt.options.build.transpile.push(resolver.resolve('./runtime'));\n\n    // Optimize @clerk/vue to avoid missing injection Symbol key errors\n    nuxt.options.vite.optimizeDeps = nuxt.options.vite.optimizeDeps || {};\n    nuxt.options.vite.optimizeDeps.include = nuxt.options.vite.optimizeDeps.include || [];\n    nuxt.options.vite.optimizeDeps.include.push('@clerk/vue');\n\n    // Add the `@clerk/vue` plugin\n    addPlugin(resolver.resolve('./runtime/plugin'));\n\n    // Allow skipping installing the server middleware\n    // and let the user handle it manually\n    if (!options.skipServerMiddleware) {\n      addServerHandler({\n        middleware: true,\n        handler: resolver.resolve('./runtime/server/middleware'),\n      });\n    }\n\n    // Adds TS support for `event.context.auth()` in event handlers\n    addTypeTemplate(\n      {\n        filename: 'types/clerk.d.ts',\n        getContents: () => `import type { SessionAuthObject } from '@clerk/backend';\n          import type { AuthFn } from '@clerk/nuxt/server';\n\n          declare module 'h3' {\n            interface H3EventContext {\n              auth: SessionAuthObject & AuthFn;\n            }\n          }\n        `,\n      },\n      { nitro: true },\n    );\n\n    // Add auto-imports for Clerk components, composables and client utils\n    addImportsDir(resolver.resolve('./runtime/composables'));\n    addImports([\n      {\n        name: 'createRouteMatcher',\n        from: resolver.resolve('./runtime/client'),\n      },\n      {\n        name: 'updateClerkOptions',\n        from: resolver.resolve('./runtime/client'),\n      },\n    ]);\n\n    // eslint-disable-next-line @typescript-eslint/consistent-type-imports\n    const components: Array<keyof typeof import('@clerk/vue')> = [\n      // Authentication Components\n      'SignIn',\n      'SignUp',\n      'GoogleOneTap',\n      // Unstyled Components\n      'SignInButton',\n      'SignOutButton',\n      'SignUpButton',\n      'SignInWithMetamaskButton',\n      // User Components\n      'UserButton',\n      'UserProfile',\n      // Organization Components\n      'CreateOrganization',\n      'OrganizationProfile',\n      'OrganizationSwitcher',\n      'OrganizationList',\n      // Billing Components\n      'PricingTable',\n      // Control Components\n      'ClerkLoaded',\n      'ClerkLoading',\n      'Protect',\n      'RedirectToSignIn',\n      'RedirectToSignUp',\n      'RedirectToUserProfile',\n      'RedirectToOrganizationProfile',\n      'RedirectToCreateOrganization',\n      'SignedIn',\n      'SignedOut',\n      'Waitlist',\n      // API Keys Components\n      'APIKeys',\n    ];\n    components.forEach(component => {\n      void addComponent({\n        name: component,\n        export: component,\n        filePath: '@clerk/vue',\n      });\n    });\n  },\n});\n"],"mappings":"AAEA;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACK;AA2BP,IAAO,iBAAQ,iBAAgC;AAAA,EAC7C,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,SAAS;AAAA,IACT,WAAW;AAAA,IACX,eAAe;AAAA,MACb,MAAM;AAAA,IACR;AAAA,EACF;AAAA,EACA,MAAM,SAAS,MAAM;AAKnB,SAAK,oBAAoB;AAAA;AAAA,MAEvB,QAAQ;AAAA,QACN,OAAO;AAAA,UACL,GAAG;AAAA,UACH,gBAAgB,QAAQ;AAAA,UACxB,WAAW,QAAQ;AAAA,UACnB,2BAA2B,QAAQ;AAAA,UACnC,2BAA2B,QAAQ;AAAA,UACnC,wBAAwB,QAAQ;AAAA,UAChC,wBAAwB,QAAQ;AAAA,UAChC,WAAW,QAAQ;AAAA,UACnB,QAAQ,QAAQ;AAAA,UAChB,YAAY,QAAQ;AAAA,UACpB,gBAAgB,QAAQ;AAAA,UACxB,gBAAgB,QAAQ;AAAA,UACxB,aAAa,QAAQ;AAAA;AAAA;AAAA,UAGrB,UAAU,QAAQ;AAAA,UAClB,QAAQ;AAAA,UACR,YAAY;AAAA,QACd;AAAA,MACF;AAAA;AAAA,MAEA,OAAO;AAAA,QACL,WAAW;AAAA,QACX,kBAAkB;AAAA,QAClB,QAAQ;AAAA,QACR,sBAAsB;AAAA,MACxB;AAAA,IACF,CAAC;AAED,UAAM,WAAW,eAAe,YAAY,GAAG;AAG/C,SAAK,QAAQ,MAAM,UAAU,KAAK,SAAS,QAAQ,WAAW,CAAC;AAG/D,SAAK,QAAQ,KAAK,eAAe,KAAK,QAAQ,KAAK,gBAAgB,CAAC;AACpE,SAAK,QAAQ,KAAK,aAAa,UAAU,KAAK,QAAQ,KAAK,aAAa,WAAW,CAAC;AACpF,SAAK,QAAQ,KAAK,aAAa,QAAQ,KAAK,YAAY;AAGxD,cAAU,SAAS,QAAQ,kBAAkB,CAAC;AAI9C,QAAI,CAAC,QAAQ,sBAAsB;AACjC,uBAAiB;AAAA,QACf,YAAY;AAAA,QACZ,SAAS,SAAS,QAAQ,6BAA6B;AAAA,MACzD,CAAC;AAAA,IACH;AAGA;AAAA,MACE;AAAA,QACE,UAAU;AAAA,QACV,aAAa,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MASrB;AAAA,MACA,EAAE,OAAO,KAAK;AAAA,IAChB;AAGA,kBAAc,SAAS,QAAQ,uBAAuB,CAAC;AACvD,eAAW;AAAA,MACT;AAAA,QACE,MAAM;AAAA,QACN,MAAM,SAAS,QAAQ,kBAAkB;AAAA,MAC3C;AAAA,MACA;AAAA,QACE,MAAM;AAAA,QACN,MAAM,SAAS,QAAQ,kBAAkB;AAAA,MAC3C;AAAA,IACF,CAAC;AAGD,UAAM,aAAuD;AAAA;AAAA,MAE3D;AAAA,MACA;AAAA,MACA;AAAA;AAAA,MAEA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;AAAA,MAEA;AAAA,MACA;AAAA;AAAA,MAEA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;AAAA,MAEA;AAAA;AAAA,MAEA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;AAAA,MAEA;AAAA,IACF;AACA,eAAW,QAAQ,eAAa;AAC9B,WAAK,aAAa;AAAA,QAChB,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,UAAU;AAAA,MACZ,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AACF,CAAC;","names":[]}